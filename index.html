<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizador Semanal Evergreen 2D - 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0fdf4;
            background-image: radial-gradient(#dcfce7 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .card-shadow { box-shadow: 0 8px 0px rgba(0,0,0,0.05); }
        .solid-shadow { box-shadow: 4px 4px 0px rgba(0,0,0,0.1); }
        .calendar-btn { transition: all 0.2s ease; }
        .calendar-btn:hover { transform: scale(1.03); }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .link-style { color: #2563eb; text-decoration: underline; }
        .past-day { opacity: 0.7; filter: grayscale(20%); }
        .day-card-content { min-height: 550px; }
        .emergency-alert {
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { background-color: #fee2e2; border-color: #fca5a5; }
            50% { background-color: #fecaca; border-color: #f87171; }
            100% { background-color: #fee2e2; border-color: #fca5a5; }
        }

        .annual-table th, .annual-table td { border: 2px solid #ecfdf5; }
        .annual-table thead th {
            position: sticky;
            top: -1px;
            z-index: 50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .cycle-1 { background-color: #eff6ff; }
        .cycle-2 { background-color: #fefce8; }
        .cycle-3 { background-color: #fdf2f8; }
        .cycle-4 { background-color: #f0f9ff; }
        .cycle-5 { background-color: #fff7ed; }
        .cycle-6 { background-color: #faf5ff; }
        .weekend-col { background-color: #f8fafc; color: #475569; }
        
        .is-today-annual { 
            outline: 5px solid #10b981; 
            outline-offset: -5px;
            position: relative;
            background-color: #d1fae5 !important;
        }

        .annual-text-date { font-size: 1.1rem; }
        .annual-text-sub { font-size: 0.95rem; }
        .annual-text-bday { font-size: 0.9rem; }

        @media print {
            .no-print { display: none !important; }
            #annual-view { display: block !important; padding: 0 !important; }
            body { background: white !important; padding: 0 !important; }
            .max-w-\[95\%\] { max-width: 100% !important; border: none !important; }
            table { font-size: 12px !important; }
            .annual-table thead th { position: static !important; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-[95%] mx-auto bg-white rounded-[40px] shadow-2xl overflow-hidden border-8 border-white relative">
        
        <!-- CABECERA -->
        <div class="bg-emerald-500 p-6 text-white relative overflow-hidden no-print">
            <div class="absolute top-2 left-4 text-4xl opacity-50">üåø</div>
            <div class="text-center relative z-10">
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-widest uppercase mb-2">School Timetable 2D</h1>
                <p id="week-label" class="text-xl font-bold bg-white text-emerald-600 inline-block px-6 py-1 rounded-full uppercase shadow-sm tracking-tight">Cargando...</p>
            </div>
            
            <!-- Botones Reposicionados en Columna -->
            <div class="absolute top-4 right-6 flex flex-col gap-2 z-20">
                <button onclick="toggleWeekView()" id="nav-btn" class="bg-white text-emerald-600 hover:bg-emerald-50 font-bold py-2 px-6 rounded-2xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-between gap-2 border-2 border-emerald-100 min-w-[210px]">
                    <span id="btn-text">Ver Pr√≥xima Semana</span>
                    <span id="btn-icon">‚û°Ô∏è</span>
                </button>
                <button onclick="toggleView('annual')" id="annual-btn" class="bg-white text-emerald-600 hover:bg-emerald-50 font-bold py-2 px-6 rounded-2xl shadow-lg transition-all transform hover:scale-105 border-2 border-emerald-100 flex items-center justify-between gap-2 min-w-[210px]">
                    <span>Calendario Anual</span>
                    <span>üìÖ</span>
                </button>
            </div>
        </div>

        <!-- VISTA SEMANAL -->
        <div id="weekly-view" class="p-6 bg-emerald-50 no-print">
            <div id="grid-container" class="grid grid-cols-1 md:grid-cols-5 gap-4 fade-in"></div>
        </div>

        <!-- VISTA ANUAL -->
        <div id="annual-view" class="hidden p-6 bg-emerald-50 max-h-[85vh] overflow-y-auto">
            <div class="bg-white rounded-3xl p-8 shadow-xl fade-in">
                <div class="flex justify-between items-center mb-8 no-print">
                    <h2 class="text-4xl font-black text-emerald-800 uppercase tracking-tighter">Cronograma Escolar 2026</h2>
                    <div class="flex gap-3">
                        <button onclick="window.print()" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-blue-700 transition-all text-lg">Imprimir</button>
                        <button onclick="toggleView('weekly')" class="bg-emerald-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-emerald-700 transition-all text-lg">Cerrar</button>
                    </div>
                </div>
                
                <table class="w-full annual-table border-collapse">
                    <thead>
                        <tr class="text-center">
                            <th class="bg-emerald-100 p-4 text-emerald-900 font-black uppercase text-sm">Semana</th>
                            <th class="cycle-1 p-4 text-blue-900 text-base uppercase font-black">D√≠a 1</th>
                            <th class="cycle-2 p-4 text-yellow-900 text-base uppercase font-black">D√≠a 2</th>
                            <th class="cycle-3 p-4 text-pink-900 text-base uppercase font-black">D√≠a 3</th>
                            <th class="cycle-4 p-4 text-sky-900 text-base uppercase font-black">D√≠a 4</th>
                            <th class="cycle-5 p-4 text-orange-900 text-base uppercase font-black">D√≠a 5</th>
                            <th class="cycle-6 p-4 text-purple-900 text-base uppercase font-black">D√≠a 6</th>
                            <th class="weekend-col p-4 text-slate-700 text-sm uppercase font-black">Festivos / Fines de Semana</th>
                        </tr>
                    </thead>
                    <tbody id="annual-body" class="text-gray-900"></tbody>
                </table>
            </div>
        </div>

        <!-- FOOTER (RECURSOS FIJOS) -->
        <div class="bg-white p-5 border-t-2 border-dashed border-gray-200 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 no-print">
            <!-- Cumplea√±os -->
            <div class="flex items-center gap-3">
                <div class="bg-emerald-100 p-2 rounded-full text-2xl">ü•≥</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Pr√≥ximo Cumplea√±os:</p>
                    <p id="birthday-footer" class="text-[10px] text-gray-500 font-bold leading-tight text-emerald-700">Calculando...</p>
                </div>
            </div>
            <!-- Recurso Espa√±ol -->
            <div class="flex items-center gap-3 md:border-l md:pl-6 border-gray-100">
                <div class="bg-blue-100 p-2 rounded-full text-2xl">üìö</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Pr√°ctica Espa√±ol:</p>
                    <a href="https://wordwall.net/es/resource/32706393" target="_blank" class="text-[10px] link-style font-bold">Sin√≥nimos y Ant√≥nimos</a>
                </div>
            </div>
            <!-- Recurso Juegos Mentales (Brain Training) -->
            <div class="flex items-center gap-3 lg:border-l lg:pl-6 border-gray-100">
                <div class="bg-purple-100 p-2 rounded-full text-2xl">üß†</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Juegos Mentales:</p>
                    <a href="https://www.cokitos.com/tag/juegos-de-atencion/" target="_blank" class="text-[10px] link-style font-bold">Entrena tu Atenci√≥n</a>
                </div>
            </div>
            <!-- Recurso Phonics -->
            <div class="flex items-center gap-3 lg:border-l lg:pl-6 border-gray-100">
                <div class="bg-red-100 p-2 rounded-full text-2xl">üîä</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Phonics Sounds:</p>
                    <a href="https://www.youtube.com/watch?v=ChqnN3cKzXQ" target="_blank" class="text-[10px] link-style font-bold">Video: Pronunciation</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const REAL_TODAY = new Date();

        const BIRTHDAYS = [
            { name: "Luciana Rubio", month: 0, day: 5 },
            { name: "Mart√≠n Chac√≥n", month: 1, day: 7 },
            { name: "Ada Rodr√≠guez", month: 2, day: 1 },
            { name: "Mateo Zambrano", month: 2, day: 2 },
            { name: "Profe Viviana Espinosa", month: 2, day: 3 },
            { name: "Alejandro Marmolejo", month: 2, day: 6 },
            { name: "Alana Rodr√≠guez", month: 3, day: 2 },
            { name: "Hanna Baiz", month: 3, day: 10 },
            { name: "Aisu Wang", month: 3, day: 11 },
            { name: "Mat√≠as Pizarro", month: 3, day: 12 },
            { name: "Manuela Lara", month: 5, day: 9 },
            { name: "Mat√≠as Alfonso", month: 5, day: 23 },
            { name: "Isabella Villegas", month: 5, day: 26 },
            { name: "Maria Jos√© Carranza", month: 6, day: 17 },
            { name: "Federico Mendoza", month: 6, day: 19 },
            { name: "Zaida Villamil Becerra", month: 7, day: 20 },
            { name: "Sara Gabriela Albarrac√≠n", month: 7, day: 22 },
            { name: "Isabella Ram√≠rez", month: 8, day: 12 },
            { name: "Samantha Hern√°ndez", month: 8, day: 29 },
            { name: "Ivanna Bulla", month: 9, day: 14 },
            { name: "Alejandro Higuera", month: 9, day: 15 },
            { name: "Emiliano Ram√≠rez", month: 9, day: 26 },
            { name: "Antonio Amortegui", month: 9, day: 28 },
            { name: "Nicol√°s Ribero", month: 10, day: 18 },
            { name: "Guadalupe Carvajal", month: 11, day: 11 },
            { name: "Pablo Galeano", month: 11, day: 27 }
        ];

        const HOLIDAYS_2026 = [
            "2026-01-01", "2026-01-12", "2026-03-23", "2026-04-02", "2026-04-03",
            "2026-05-01", "2026-05-18", "2026-06-08", "2026-06-15", "2026-06-29",
            "2026-07-20", "2026-08-07", "2026-08-17", "2026-10-12", "2026-11-02",
            "2026-11-16", "2026-12-08", "2026-12-25"
        ];

        const CYCLE_ANCHOR_DATE = new Date(2026, 1, 4); 
        const CYCLE_ANCHOR_DAY_NUM = 1; 

        const schedules = {
            1: "<li>‚Ä¢ Psicomotricidad</li><li>‚Ä¢ Math</li><li>‚Ä¢ English</li><li>‚Ä¢ STEM</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Danza</li>",
            2: "<li>‚Ä¢ English</li><li>‚Ä¢ M√∫sica</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Social Science</li><li>‚Ä¢ Science</li><li>‚Ä¢ Math</li>",
            3: "<li>‚Ä¢ Science</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ English</li><li>‚Ä¢ Phonics</li><li>‚Ä¢ Math</li><li><li>‚Ä¢ Psicomotricidad</li>",
            4: "<li>‚Ä¢ English</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Perfil Evergreenista</li><li>‚Ä¢ Artes</li><li>‚Ä¢ Science</li><li>‚Ä¢ Math</li>",
            5: "<li>‚Ä¢ English</li><li>‚Ä¢ Phonics</li><li>‚Ä¢ Psicomotricidad</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Social Science</li><li>‚Ä¢ Math</li>",
            6: "<li>‚Ä¢ Artes</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Socioemocional</li><li>‚Ä¢ Math</li><li>‚Ä¢ English</li><li>‚Ä¢ Teatro</li>"
        };

        const specialActivities = {
            "2026-02-16": {
                html: `<div class="bg-blue-50 p-2 rounded-lg border border-blue-200 mb-2"><p class="text-[9px] text-blue-700 font-black uppercase">üó≥Ô∏è GOBIERNO ESCOLAR:</p><p class="text-[10px] text-blue-800 font-bold leading-tight">Socializaci√≥n de requisitos en tutor√≠a.</p></div>`,
                reminder: "Gobierno Escolar: Socializaci√≥n requisitos"
            },
            "2026-02-19": {
                html: `<div class="emergency-alert p-2 rounded-lg border border-red-300 mb-2"><p class="text-[9px] text-red-700 font-black uppercase">‚ö†Ô∏è AVISO:</p><p class="text-[10px] text-red-800 font-bold leading-tight uppercase">Salida Temprana 2:00 P.M.</p></div>`,
                reminder: "SALIDA TEMPRANA 2:00 PM"
            },
            "2026-02-23": {
                html: `<div class="bg-orange-100 p-2 rounded-lg border border-orange-200 mb-2"><p class="text-[9px] text-orange-700 font-black uppercase">üó≥Ô∏è PLAZO FINAL:</p><p class="text-[10px] text-orange-800 font-bold leading-tight">Entrega hoja de vida al tutor.</p></div>`,
                reminder: "Gobierno Escolar: Plazo entrega hoja de vida"
            },
            "2026-02-24": {
                html: `<div class="bg-emerald-50 p-2 rounded-lg border border-emerald-200 mb-2"><p class="text-[9px] text-emerald-700 font-black uppercase">üó≥Ô∏è GOBIERNO ESCOLAR:</p><p class="text-[10px] text-emerald-800 font-bold leading-tight">Confirmaci√≥n y aprobaci√≥n candidaturas.</p></div>`,
                reminder: "Gobierno Escolar: Aprobaci√≥n candidaturas"
            },
            "2026-02-27": {
                html: `<div class="bg-purple-100 p-2 rounded-lg border border-purple-300 mb-2"><p class="text-[9px] text-purple-700 font-black uppercase">üìÇ SOCIOEMOCIONAL:</p><p class="text-[10px] text-purple-800 font-bold leading-tight italic">Traer la carpeta con la portada impresa.</p></div>`,
                reminder: "Socioemocional: Traer carpeta con portada"
            },
            "2026-03-02": { html: `<div class="bg-blue-50 p-2 rounded-lg border border-blue-200 mb-2"><p class="text-[9px] text-blue-700 font-black uppercase">üó≥Ô∏è CAMPA√ëA:</p><p class="text-[10px] text-blue-800 font-bold leading-tight">Inicio socializaci√≥n propuestas.</p></div>`, reminder: "Campa√±a: Socializaci√≥n propuestas" },
            "2026-03-09": { html: `<div class="emergency-alert p-2 rounded-lg border border-red-300 mb-2"><p class="text-[9px] text-red-700 font-black uppercase">üó≥Ô∏è ELECCIONES:</p><p class="text-[10px] text-red-800 font-bold leading-tight">D√≠a de votaci√≥n Gobierno Escolar.</p></div>`, reminder: "D√çA DE ELECCIONES" },
            "2026-03-13": { html: `<div class="bg-emerald-100 p-2 rounded-lg border border-emerald-300 mb-2"><p class="text-[9px] text-emerald-700 font-black uppercase">üìú POSESI√ìN:</p><p class="text-[10px] text-emerald-800 font-bold leading-tight">Posesi√≥n oficial representantes.</p></div>`, reminder: "Posesi√≥n de representantes" }
        };

        let viewOffset = 0; 
        let currentActiveView = 'weekly';

        function isHoliday(date) {
            const iso = date.toISOString().split('T')[0];
            return HOLIDAYS_2026.includes(iso);
        }

        function isNonWorkingDay(date) {
            const day = date.getDay();
            return (day === 0 || day === 6) || isHoliday(date);
        }

        function getNextSchoolDay(date) {
            let check = new Date(date);
            while (isNonWorkingDay(check)) { check.setDate(check.getDate() + 1); }
            return check;
        }

        function getCycleDay(targetDate) {
            if (isNonWorkingDay(targetDate)) return null;
            const diffTime = targetDate - CYCLE_ANCHOR_DATE;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            let nonWorkingCount = 0;
            let tempDate = new Date(CYCLE_ANCHOR_DATE);
            let step = diffDays >= 0 ? 1 : -1;
            let absoluteDiff = Math.abs(diffDays);
            
            for (let i = 0; i < absoluteDiff; i++) {
                tempDate.setDate(tempDate.getDate() + step);
                if (isNonWorkingDay(tempDate)) nonWorkingCount += step;
            }
            const schoolDaysDiff = diffDays - nonWorkingCount;
            let result = (CYCLE_ANCHOR_DAY_NUM + schoolDaysDiff) % 6;
            if (result <= 0) result += 6;
            return result;
        }

        function getUniformByCycle(cycleDay) {
            if (!cycleDay) return "N/A";
            return (cycleDay % 2 !== 0) ? "Sudadera üëü" : "Diario üëû";
        }

        function getMondayOfCurrentWeek() {
            const today = new Date(REAL_TODAY);
            const day = today.getDay();
            const diff = today.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(today.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function toggleView(viewType) {
            currentActiveView = viewType;
            if (viewType === 'annual') {
                document.getElementById('weekly-view').classList.add('hidden');
                document.getElementById('nav-btn').classList.add('hidden');
                document.getElementById('annual-view').classList.remove('hidden');
                document.getElementById('week-label').innerText = "Cronograma Anual 2026";
                renderAnnualCalendar();
            } else {
                document.getElementById('weekly-view').classList.remove('hidden');
                document.getElementById('nav-btn').classList.remove('hidden');
                document.getElementById('annual-view').classList.add('hidden');
                renderCalendar();
            }
        }

        function renderAnnualCalendar() {
            const tbody = document.getElementById('annual-body');
            tbody.innerHTML = '';
            let checkDate = new Date(2026, 1, 4); 
            const endDate = new Date(2026, 11, 31);
            const todayISO = REAL_TODAY.toISOString().split('T')[0];
            const monthNames = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];
            const dayNamesShort = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];
            let weekNumber = 1;

            while (checkDate <= endDate) {
                let cycleRow = { 1: null, 2: null, 3: null, 4: null, 5: null, 6: null };
                let weekendItems = [];
                let daysInCycle = 0;

                while (daysInCycle < 6 && checkDate <= endDate) {
                    const iso = checkDate.toISOString().split('T')[0];
                    const bdays = BIRTHDAYS.filter(b => b.month === checkDate.getMonth() && b.day === checkDate.getDate());
                    const dateLabel = `${dayNamesShort[checkDate.getDay()]}, ${checkDate.getDate()} ${monthNames[checkDate.getMonth()]}`;

                    if (isNonWorkingDay(checkDate)) {
                        let info = `<span class="font-bold annual-text-date">${dateLabel}</span>`;
                        if (bdays.length > 0) {
                            info += bdays.map(b => `<br><span class="text-blue-700 font-black annual-text-bday">üéÇ ${b.name}</span>`).join('');
                        } else if (isHoliday(checkDate)) {
                            info += `<br><span class="text-red-600 font-black uppercase annual-text-sub">FESTIVO</span>`;
                        }
                        weekendItems.push(info);
                    } else {
                        const cycle = getCycleDay(checkDate);
                        if (cycle) {
                            let cellContent = `<p class="font-black text-gray-900 annual-text-date mb-1">${dateLabel}</p>`;
                            cellContent += `<p class="annual-text-sub font-bold text-emerald-700 leading-tight">${getUniformByCycle(cycle)}</p>`;
                            if (bdays.length > 0) {
                                cellContent += bdays.map(b => `<p class="text-blue-800 annual-text-bday mt-1 leading-tight font-black">üéÇ ${b.name}</p>`).join('');
                            }
                            if (specialActivities[iso]) {
                                cellContent += `<p class="text-[9px] mt-1 text-orange-600 font-bold">‚ö†Ô∏è ${specialActivities[iso].reminder}</p>`;
                            }
                            cycleRow[cycle] = { 
                                html: cellContent,
                                isToday: iso === todayISO
                            };
                            daysInCycle++;
                        }
                    }
                    checkDate.setDate(checkDate.getDate() + 1);
                }

                let rowHtml = `<tr class="border-b-2 border-emerald-50">
                    <td class="bg-emerald-50 p-4 text-center font-black text-emerald-800 text-sm uppercase border-r border-emerald-100">S${weekNumber++}</td>`;
                
                for (let c = 1; c <= 6; c++) {
                    const d = cycleRow[c];
                    rowHtml += d ? `<td class="p-4 text-center cycle-${c} ${d.isToday ? 'is-today-annual' : ''}">
                        ${d.html}
                    </td>` : `<td class="p-4 bg-gray-50 opacity-10"></td>`;
                }

                rowHtml += `<td class="p-4 weekend-col annual-text-sub leading-relaxed border-l border-emerald-100">
                    ${weekendItems.length > 0 ? weekendItems.join('<div class="my-2 border-b border-gray-200"></div>') : '-'}
                </td></tr>`;
                
                tbody.insertAdjacentHTML('beforeend', rowHtml);
            }
        }

        function renderCalendar() {
            if (currentActiveView === 'annual') return;
            const container = document.getElementById('grid-container');
            container.innerHTML = '';
            const todayISO = REAL_TODAY.toISOString().split('T')[0];
            
            let startDay = getMondayOfCurrentWeek();
            startDay.setDate(startDay.getDate() + (viewOffset * 7));
            
            const endDay = new Date(startDay);
            endDay.setDate(endDay.getDate() + 4);
            document.getElementById('week-label').innerText = `${viewOffset === 0 ? 'Semana Actual' : 'Pr√≥xima Semana'} (${startDay.getDate()}/${startDay.getMonth()+1} - ${endDay.getDate()}/${endDay.getMonth()+1})`;
            
            const dayNames = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"];
            const colors = ["bg-blue-500", "bg-yellow-400", "bg-pink-400", "bg-sky-400", "bg-orange-400"];

            for (let i = 0; i < 5; i++) {
                const curr = new Date(startDay);
                curr.setDate(startDay.getDate() + i);
                const iso = curr.toISOString().split('T')[0];
                const isToday = iso === todayISO;
                
                const tempToday = new Date(REAL_TODAY);
                tempToday.setHours(0,0,0,0);
                const tempCurr = new Date(curr);
                tempCurr.setHours(0,0,0,0);
                
                const isPast = tempCurr < tempToday;
                const itsHoliday = isHoliday(curr);
                const numDia = getCycleDay(curr);
                const uniform = itsHoliday ? "N/A" : getUniformByCycle(numDia);
                
                let activityHtml = "";
                const bdays = BIRTHDAYS.reduce((acc, b) => {
                    const realDate = new Date(curr.getFullYear(), b.month, b.day);
                    if (curr.toDateString() === getNextSchoolDay(realDate).toDateString()) acc.push(b.name);
                    return acc;
                }, []);
                bdays.forEach(name => activityHtml += `<div class="bg-blue-100 p-2 rounded-lg border border-blue-200 mb-2 text-[10px] text-blue-700 font-bold">üéÇ Cumple: ${name}</div>`);
                
                if (specialActivities[iso]) activityHtml += specialActivities[iso].html;

                container.insertAdjacentHTML('beforeend', `
                    <div class="flex flex-col h-full ${isPast ? 'past-day' : ''} ${isToday ? 'scale-105 z-10' : ''}">
                        <div class="${itsHoliday ? 'bg-gray-400' : colors[i]} text-white p-3 text-center rounded-t-3xl font-bold uppercase text-lg">
                            ${isToday ? '‚≠êÔ∏è ' : ''}${dayNames[i]} ${curr.getDate()}
                        </div>
                        <div class="bg-white p-4 flex-grow border-x-4 border-b-4 ${itsHoliday ? 'border-gray-200' : colors[i].replace('bg-', 'border-')} rounded-b-3xl day-card-content shadow-lg">
                            <div class="mb-3 text-[10px] font-bold px-2 py-0.5 rounded bg-gray-100 uppercase inline-block">${itsHoliday ? 'FESTIVO' : 'D√≠a ' + (numDia || '-')}</div>
                            ${itsHoliday ? '<p class="text-center py-20 text-gray-400 font-bold">Descanso</p>' : `
                                <div class="mb-4"><p class="text-xs font-bold text-gray-700">üëî Uniforme:</p><p class="text-sm font-black italic ${colors[i].replace('bg-', 'text-')}">${uniform}</p></div>
                                <div class="bg-orange-50 p-3 rounded-2xl border-2 border-orange-100 mb-4 min-h-[140px]">${activityHtml || '<p class="text-[9px] text-gray-400 italic">Sin tareas especiales</p>'}</div>
                                <div class="flex-grow"><ul class="text-[11px] text-gray-700 space-y-1">${numDia ? (schedules[numDia] || '') : '<li>No hay clases</li>'}</ul></div>
                                <button onclick="handleCalendar('${iso}', '${dayNames[i]}', '${uniform}', '${encodeURIComponent(specialActivities[iso]?.reminder || 'Clase normal')}')" class="calendar-btn mt-4 w-full bg-emerald-500 text-white py-3 rounded-xl text-[10px] font-black uppercase shadow-md">Agendar</button>
                            `}
                        </div>
                    </div>
                `);
            }
            updateBirthdayFooter();
        }

        function toggleWeekView() {
            viewOffset = viewOffset === 0 ? 1 : 0;
            document.getElementById('btn-text').innerText = viewOffset === 0 ? "Ver Pr√≥xima Semana" : "Volver a Actual";
            document.getElementById('btn-icon').innerText = viewOffset === 0 ? "‚û°Ô∏è" : "‚¨ÖÔ∏è";
            renderCalendar();
        }

        function updateBirthdayFooter() {
            const currentYear = REAL_TODAY.getFullYear();
            const upcoming = BIRTHDAYS.map(b => {
                let bDate = new Date(currentYear, b.month, b.day);
                if (bDate < REAL_TODAY) bDate = new Date(currentYear + 1, b.month, b.day);
                return { ...b, date: bDate };
            }).sort((a, b) => a.date - b.date);
            document.getElementById('birthday-footer').innerText = `${upcoming[0].name} (${upcoming[0].date.getDate()} ${upcoming[0].date.toLocaleDateString('es-ES', {month:'short'})})`;
        }

        window.handleCalendar = function(dateStr, day, uniform, act) {
            const title = `Evergreen: ${day}`;
            const details = `Uniforme: ${uniform}\nNotas: ${decodeURIComponent(act)}`;
            const dateStrClean = dateStr.replace(/-/g, '');
            window.open(`https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${dateStrClean}T070000/${dateStrClean}T080000&details=${encodeURIComponent(details)}`, '_blank');
        };

        window.onload = function() {
            renderCalendar();
        };
    </script>
</body>
</html>
