<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizador Semanal Evergreen 2D - 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0fdf4;
            background-image: radial-gradient(#dcfce7 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .card-shadow { box-shadow: 0 8px 0px rgba(0,0,0,0.05); }
        .calendar-btn { transition: all 0.2s ease; }
        .calendar-btn:hover { transform: scale(1.03); }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .link-style { color: #2563eb; text-decoration: underline; }
        .past-day { opacity: 0.7; filter: grayscale(20%); }
        .day-card-content { min-height: 700px; }
        .emergency-alert {
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { background-color: #fee2e2; border-color: #fca5a5; }
            50% { background-color: #fecaca; border-color: #f87171; }
            100% { background-color: #fee2e2; border-color: #fca5a5; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-[95%] mx-auto bg-white rounded-[40px] shadow-2xl overflow-hidden border-8 border-white relative">
        
        <!-- CABECERA -->
        <div class="bg-emerald-500 p-6 text-white relative overflow-hidden">
            <div class="absolute top-2 left-4 text-4xl opacity-50">üåø</div>
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-widest uppercase mb-2">School Timetable 2D</h1>
                <p id="week-label" class="text-xl font-bold bg-white text-emerald-600 inline-block px-6 py-1 rounded-full uppercase shadow-sm tracking-tight">Cargando semana...</p>
            </div>
            <button onclick="toggleWeekView()" id="nav-btn" class="absolute top-6 right-6 bg-white text-emerald-600 hover:bg-emerald-50 font-bold py-2 px-6 rounded-2xl shadow-lg transition-all transform hover:scale-105 flex items-center gap-2 z-20 border-2 border-emerald-100">
                <span id="btn-text">Ver Pr√≥xima Semana</span>
                <span id="btn-icon">‚û°Ô∏è</span>
            </button>
        </div>

        <!-- CONTENEDOR PRINCIPAL -->
        <div id="main-content" class="p-6 bg-emerald-50">
            <div id="grid-container" class="grid grid-cols-1 md:grid-cols-5 gap-4 fade-in">
                <!-- Inyectado por JS -->
            </div>
        </div>

        <!-- FOOTER MULTI-RECURSO -->
        <div class="bg-white p-5 border-t-2 border-dashed border-gray-200 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="flex items-center gap-3">
                <div class="bg-emerald-100 p-2 rounded-full text-2xl">ü•≥</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Pr√≥ximo Cumplea√±os:</p>
                    <p id="birthday-footer" class="text-[10px] text-gray-500 font-bold leading-tight text-emerald-700">Calculando...</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3 md:border-l md:pl-6 border-gray-100">
                <div class="bg-blue-100 p-2 rounded-full text-2xl">üìö</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Pr√°ctica Espa√±ol:</p>
                    <a href="https://wordwall.net/es/resource/32706393" target="_blank" class="text-[10px] link-style font-bold">Sin√≥nimos Wordwall</a>
                </div>
            </div>

            <div class="flex items-center gap-3 lg:border-l lg:pl-6 border-gray-100">
                <div class="bg-purple-100 p-2 rounded-full text-2xl">üß†</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Microhabilidades:</p>
                    <a href="https://gemini.google.com/share/33c59ed472e7" target="_blank" class="text-[10px] link-style font-bold text-purple-700">Juegos Mentales</a>
                </div>
            </div>

            <div class="flex items-center gap-3 lg:border-l lg:pl-6 border-gray-100">
                <div class="bg-red-100 p-2 rounded-full text-2xl">üîä</div>
                <div>
                    <p class="font-bold text-gray-800 text-xs uppercase">Pr√°ctica Phonics:</p>
                    <div class="flex flex-col gap-1">
                        <a href="https://www.youtube.com/watch?v=ChqnN3cKzXQ&t=1s" target="_blank" class="text-[9px] link-style font-bold text-red-600">Video 1: Sounds</a>
                        <a href="https://www.youtube.com/watch?v=_mppVx-O4q8&list=RD_mppVx-O4q8&start_radio=1" target="_blank" class="text-[9px] link-style font-bold text-red-600">Video 2: Practice</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-emerald-50 text-emerald-700 px-4 py-2 text-center text-[10px] font-bold border-t border-emerald-100 uppercase">
            ‚öôÔ∏è Calendario Din√°mico | Horario Actualizado v2025-2026 | Aviso Salida 19-Feb
        </div>
    </div>

    <script>
        const BIRTHDAYS = [
            { name: "Luciana Rubio", month: 0, day: 5 },
            { name: "Mart√≠n Chac√≥n", month: 1, day: 7 },
            { name: "Ada Rodr√≠guez", month: 2, day: 1 },
            { name: "Mateo Zambrano", month: 2, day: 2 },
            { name: "Profe Viviana Espinosa", month: 2, day: 3 },
            { name: "Alejandro Marmolejo", month: 2, day: 6 },
            { name: "Alana Rodr√≠guez", month: 3, day: 2 },
            { name: "Hanna Baiz", month: 3, day: 10 },
            { name: "Aisu Wang", month: 3, day: 11 },
            { name: "Mat√≠as Pizarro", month: 3, day: 12 },
            { name: "Manuela Lara", month: 5, day: 9 },
            { name: "Mat√≠as Alfonso", month: 5, day: 23 },
            { name: "Isabella Villegas", month: 5, day: 26 },
            { name: "Maria Jos√© Carranza", month: 6, day: 17 },
            { name: "Federico Mendoza", month: 6, day: 19 },
            { name: "Zaida Villamil Becerra", month: 7, day: 20 },
            { name: "Sara Gabriela Albarrac√≠n", month: 7, day: 22 },
            { name: "Isabella Ram√≠rez", month: 8, day: 12 },
            { name: "Samantha Hern√°ndez", month: 8, day: 29 },
            { name: "Ivanna Bulla", month: 9, day: 14 },
            { name: "Alejandro Higuera", month: 9, day: 15 },
            { name: "Emiliano Ram√≠rez", month: 9, day: 26 },
            { name: "Antonio Amortegui", month: 9, day: 28 },
            { name: "Nicol√°s Ribero", month: 10, day: 18 },
            { name: "Guadalupe Carvajal", month: 11, day: 11 },
            { name: "Pablo Galeano", month: 11, day: 27 }
        ];

        const HOLIDAYS_2026 = [
            "2026-01-01", "2026-01-12", "2026-03-23", "2026-04-02", "2026-04-03",
            "2026-05-01", "2026-05-18", "2026-06-08", "2026-06-15", "2026-06-29",
            "2026-07-20", "2026-08-07", "2026-08-17", "2026-10-12", "2026-11-02",
            "2026-11-16", "2026-12-08", "2026-12-25"
        ];

        const CYCLE_ANCHOR_DATE = new Date(2026, 1, 16); 
        const CYCLE_ANCHOR_DAY_NUM = 3; 

        const schedules = {
            1: "<li>‚Ä¢ Psicomotricidad</li><li>‚Ä¢ Math</li><li>‚Ä¢ English</li><li>‚Ä¢ STEM</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Danza</li>",
            2: "<li>‚Ä¢ English</li><li>‚Ä¢ M√∫sica</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Social Science</li><li>‚Ä¢ Science</li><li>‚Ä¢ Math</li>",
            3: "<li>‚Ä¢ Science</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ English</li><li>‚Ä¢ Phonics</li><li>‚Ä¢ Math</li><li>‚Ä¢ Psicomotricidad</li>",
            4: "<li>‚Ä¢ English</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Perfil Evergreenista</li><li>‚Ä¢ Artes</li><li>‚Ä¢ Science</li><li>‚Ä¢ Math</li>",
            5: "<li>‚Ä¢ English</li><li>‚Ä¢ Phonics</li><li>‚Ä¢ Psicomotricidad</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Social Science</li><li>‚Ä¢ Math</li>",
            6: "<li>‚Ä¢ Artes</li><li>‚Ä¢ Espa√±ol</li><li>‚Ä¢ Socioemocional</li><li>‚Ä¢ Math</li><li>‚Ä¢ English</li><li>‚Ä¢ Teatro</li>"
        };

        const specialActivities = {
            "2026-02-19": {
                html: `
                    <div class="emergency-alert p-2 rounded-lg border border-red-300 mb-2">
                        <p class="text-[9px] text-red-700 font-black uppercase">‚ö†Ô∏è CAMBIO DE HORARIO:</p>
                        <p class="text-[10px] text-red-800 font-bold leading-tight">SALIDA TEMPRANA 2:00 P.M. por manifestaciones.</p>
                    </div>
                `,
                reminder: "SALIDA TEMPRANA 2:00 PM - Manifestaciones en Bogot√°"
            },
            "2026-02-27": {
                html: `
                    <div class="bg-purple-100 p-2 rounded-lg border border-purple-300 mb-2">
                        <p class="text-[9px] text-purple-700 font-black uppercase">üìÇ SOCIOEMOCIONAL:</p>
                        <p class="text-[10px] text-purple-800 font-bold leading-tight italic">Traer la carpeta con la portada impresa.</p>
                    </div>
                `,
                reminder: "Socioemocional: Traer carpeta con portada impresa"
            }
        };

        let viewOffset = 0; 
        let startDayCalculated;

        function isHoliday(date) {
            const iso = date.toISOString().split('T')[0];
            return HOLIDAYS_2026.includes(iso);
        }

        function isNonWorkingDay(date) {
            const day = date.getDay();
            if (day === 0 || day === 6) return true;
            return isHoliday(date);
        }

        function getNextSchoolDay(date) {
            let check = new Date(date);
            while (isNonWorkingDay(check)) {
                check.setDate(check.getDate() + 1);
            }
            return check;
        }

        function getCycleDay(targetDate) {
            if (isNonWorkingDay(targetDate)) return null;
            
            const diffTime = targetDate - CYCLE_ANCHOR_DATE;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            let nonWorkingCount = 0;
            let tempDate = new Date(CYCLE_ANCHOR_DATE);
            let step = diffDays >= 0 ? 1 : -1;
            let absoluteDiff = Math.abs(diffDays);
            
            for (let i = 0; i < absoluteDiff; i++) {
                tempDate.setDate(tempDate.getDate() + step);
                if (isNonWorkingDay(tempDate)) nonWorkingCount += step;
            }
            
            const schoolDaysDiff = diffDays - nonWorkingCount;
            let result = (CYCLE_ANCHOR_DAY_NUM + schoolDaysDiff) % 6;
            if (result <= 0) result += 6;
            return result;
        }

        function getUniformByCycle(cycleDay) {
            if (!cycleDay) return "N/A";
            return (cycleDay % 2 !== 0) ? "Sudadera üëü" : "Diario üëû";
        }

        function getMondayOfCurrentWeek() {
            const today = new Date();
            const day = today.getDay();
            const diff = today.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(today.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function updateBirthdayFooter() {
            const today = new Date();
            today.setHours(0,0,0,0);
            const currentYear = today.getFullYear();
            const footer = document.getElementById('birthday-footer');

            const upcoming = BIRTHDAYS.map(b => {
                let bDate = new Date(currentYear, b.month, b.day);
                if (bDate < today) bDate = new Date(currentYear + 1, b.month, b.day);
                return { ...b, date: bDate };
            }).sort((a, b) => a.date - b.date);

            const startOfView = new Date(startDayCalculated);
            const endOfView = new Date(startDayCalculated);
            endOfView.setDate(startOfView.getDate() + 6);

            const inView = BIRTHDAYS.find(b => {
                const realDate = new Date(startOfView.getFullYear(), b.month, b.day);
                const celebDate = getNextSchoolDay(realDate);
                return (realDate >= startOfView && realDate <= endOfView) || 
                       (celebDate >= startOfView && celebDate <= endOfView);
            });

            if (inView) {
                const realDate = new Date(startOfView.getFullYear(), inView.month, inView.day);
                const celebDate = getNextSchoolDay(realDate);
                const isDeferred = realDate.getTime() !== celebDate.getTime();
                footer.innerHTML = `<span class="text-emerald-600 animate-pulse">üéÇ ¬°CELEBRACI√ìN!</span><br>${inView.name} ${isDeferred ? '(Postergado)' : ''}`;
                return;
            }

            const nextB = upcoming[0];
            footer.innerHTML = `<span class="text-gray-400 italic">Pr√≥ximo:</span><br>${nextB.name} - ${nextB.date.toLocaleDateString('es-ES', {month:'long', day:'numeric'})}`;
        }

        function renderCalendar() {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';
            const today = new Date();
            today.setHours(0,0,0,0);

            startDayCalculated = getMondayOfCurrentWeek();
            startDayCalculated.setDate(startDayCalculated.getDate() + (viewOffset * 7));

            const options = { month: 'short', day: 'numeric' };
            const endDay = new Date(startDayCalculated);
            endDay.setDate(endDay.getDate() + 4);
            
            document.getElementById('week-label').innerText = 
                `${viewOffset === 0 ? 'Semana Actual' : 'Pr√≥xima Semana'} (${startDayCalculated.toLocaleDateString('es-ES', options)} - ${endDay.toLocaleDateString('es-ES', options)})`;

            const dayNames = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"];
            const colors = ["bg-blue-500", "bg-yellow-400", "bg-pink-400", "bg-sky-400", "bg-orange-400"];

            for (let i = 0; i < 5; i++) {
                const currentDate = new Date(startDayCalculated);
                currentDate.setDate(startDayCalculated.getDate() + i);
                const dateISO = currentDate.toISOString().split('T')[0];
                const isToday = currentDate.getTime() === today.getTime();
                const isPast = currentDate < today;
                const itsHoliday = isHoliday(currentDate);
                
                const numDiaCiclo = getCycleDay(currentDate);
                const uniformText = itsHoliday ? "N/A" : getUniformByCycle(numDiaCiclo);
                
                const bdayNotice = BIRTHDAYS.reduce((acc, b) => {
                    const realDate = new Date(currentDate.getFullYear(), b.month, b.day);
                    const celebDate = getNextSchoolDay(realDate);
                    if (currentDate.getTime() === celebDate.getTime()) {
                        const isDeferred = realDate.getTime() !== celebDate.getTime();
                        acc.push({ name: b.name, deferred: isDeferred });
                    }
                    return acc;
                }, []);
                
                let activityHtml = "";
                bdayNotice.forEach(notice => {
                    const label = notice.deferred ? "üéÇ CELEBRACI√ìN (Pasado):" : "üéÇ CUMPLEA√ëOS:";
                    activityHtml += `<div class="bg-blue-100 p-2 rounded-lg border border-blue-200 mb-2"><p class="text-[9px] text-blue-800 font-black uppercase">${label}</p><p class="text-[10px] text-blue-700 font-bold">${notice.name}</p></div>`;
                });
                
                const manualActivity = specialActivities[dateISO];
                activityHtml += manualActivity ? manualActivity.html : "";
                
                if (activityHtml === "" && !itsHoliday) {
                    activityHtml = `<p class="text-[9px] text-gray-400 italic font-semibold">Sin tareas especiales</p>`;
                }

                const cardHTML = `
                    <div class="flex flex-col h-full ${isPast && !isToday ? 'past-day' : ''} ${isToday ? 'scale-105 z-10' : ''}">
                        <div class="${itsHoliday ? 'bg-gray-400' : colors[i]} text-white p-3 text-center rounded-t-3xl font-bold uppercase text-lg shadow-inner">
                            ${isToday ? '‚≠êÔ∏è ' : ''}${dayNames[i]} ${currentDate.getDate()}
                        </div>
                        <div class="bg-white p-4 flex-grow border-x-4 border-b-4 ${itsHoliday ? 'border-gray-200' : colors[i].replace('bg-', 'border-')} rounded-b-3xl card-shadow flex flex-col day-card-content ${isToday ? 'ring-4 ring-emerald-200' : ''}">
                            <div class="mb-3 flex justify-between items-center">
                                <span class="bg-gray-100 text-gray-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase">${itsHoliday ? 'FESTIVO' : 'D√≠a ' + numDiaCiclo}</span>
                                ${isToday ? '<span class="text-[9px] font-black text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full border border-emerald-200">HOY</span>' : ''}
                            </div>
                            
                            ${itsHoliday ? `
                                <div class="flex-grow flex flex-col items-center justify-center text-center p-4 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200 my-4">
                                    <span class="text-4xl mb-2">üò¥</span>
                                    <p class="text-gray-500 font-black text-sm uppercase leading-tight">D√≠a Festivo</p>
                                    <p class="text-gray-400 font-bold text-[10px] uppercase">No hay clases</p>
                                    <div class="mt-4 w-full">
                                        ${activityHtml}
                                    </div>
                                </div>
                            ` : `
                                <div class="mb-4">
                                    <p class="font-bold text-gray-700 text-xs mb-0.5">üëî Uniforme:</p>
                                    <p class="${colors[i].replace('bg-', 'text-')} font-bold text-sm uppercase italic leading-tight">${uniformText}</p>
                                </div>
                                <div class="bg-orange-50 p-3 rounded-2xl border-2 border-orange-100 mb-4 min-h-[160px]">
                                    <p class="font-bold text-orange-700 text-[9px] mb-1 uppercase tracking-tighter">üöÄ Actividades / Tareas:</p>
                                    ${activityHtml}
                                </div>
                                <div class="mb-3 flex-grow">
                                    <p class="font-bold text-gray-400 text-[10px] uppercase mb-1 tracking-wider">üìö Horario</p>
                                    <ul class="text-[11px] text-gray-700 space-y-1 font-medium">${schedules[numDiaCiclo] || '<li>No hay clases</li>'}</ul>
                                </div>
                                <button onclick="handleCalendar('${dateISO}', '${dayNames[i]}', '${uniformText}', '${encodeURIComponent(manualActivity?.reminder || 'Sin tareas')}')" class="calendar-btn mt-4 w-full bg-emerald-500 text-white py-3 rounded-xl text-[10px] font-black shadow-md uppercase tracking-widest border-b-4 border-emerald-700">üìÖ AGENDAR</button>
                            `}
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', cardHTML);
            }
            updateBirthdayFooter();
        }

        function toggleWeekView() {
            viewOffset = viewOffset === 0 ? 1 : 0;
            document.getElementById('btn-text').innerText = viewOffset === 0 ? "Ver Pr√≥xima Semana" : "Volver a Actual";
            renderCalendar();
        }

        window.handleCalendar = function(dateStr, dayName, uniform, activityText) {
            const decodedActivity = decodeURIComponent(activityText);
            const title = encodeURIComponent(`COLEGIO 2D: ${dayName}`);
            const body = encodeURIComponent(`üëî UNIFORME: ${uniform}\n\nüìù TAREAS:\n${decodedActivity}`);
            
            // Formatear fecha para Google Calendar (YYYYMMDD)
            const dateParts = dateStr.split('-');
            const formattedDate = dateParts.join('');
            const endDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
            endDate.setDate(endDate.getDate() + 1);
            const formattedEndDate = endDate.toISOString().split('T')[0].split('-').join('');

            window.open(`https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${formattedDate}/${formattedEndDate}&details=${body}`, '_blank');
        };

        document.addEventListener('DOMContentLoaded', renderCalendar);
    </script>
</body>
</html>
